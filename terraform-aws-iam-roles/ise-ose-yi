Below is a **field-ready runbook** to isolate why your AWS Reveal(x) sensor shows *“Ready for Traffic – no data feed detected”* in a **cross-account GWLB + Traffic Mirroring** design (DEV → GWLBe → GWLB in CD → ExtraHop sensor EC2). You can do everything from the **ExtraHop console** and the **AWS consoles** (no SSH required).

---

# 1) Validate the sensor is actually listening for encapsulated mirror traffic

### On the ExtraHop **sensor console**

1. **Interfaces → Roles**

   * Ensure **Interface 1 = Management** (default gateway only on this interface).
   * Ensure **Interface 2 = “Management + RPCAP/ERSPAN/VXLAN/GENEVE Target.”**
     This is correct for receiving **VXLAN (VPC Mirroring)** and **GENEVE (GWLB)**.
   * It’s fine to use the *same subnet* for mgmt & capture, but **only Management** should have the default route. If both NICs show a gateway, remove the gateway from Interface 2 (capture) so replies don’t hairpin out the capture NIC.

2. **Packet Ingest Settings**

   * Keep **“Ingest packets from direct traffic feed”** selected (your screenshot shows this).
   * Do **not** enable Netskope ingest unless you’re using that integration.

3. **Health → Interfaces**

   * Watch **RX Packets/RX Bytes** on **Interface 2** for any increase over 1–2 minutes.
     If these remain flat, the appliance is up but **no encapsulated packets** are arriving.

> If Interface 2 counters don’t move, the problem is **outside the sensor** (GWLB/endpoint/filters/SG/NACL/AZ mapping).

---

# 2) Prove the GWLB data path in AWS (cross-account)

### A. In the **DEV** account (the mirrored source)

1. **Traffic Mirror Session**

   * **Source ENI** = the workload ENI you intend to mirror.
   * **Target** = **Gateway Load Balancer endpoint (GWLBe)**, not an ENI/NLB.
   * **Session status** = *Enabled*, **PacketLength** ≥ **128** (prefer **1500** for full frames).
   * **Session number (priority)** unique (lower number wins if there are overlaps).
   * **Filter**: for testing, set **an ALLOW-ALL filter** (both directions, all protocols). Tighten later.

2. **AZ alignment (critical)**
   Traffic Mirroring to a GWLBe **must be AZ-local**:

   * The **source ENI** and the **GWLBe** must be in the **same AZ**.
   * If you mirror from multiple AZs, you need **one GWLBe per AZ** and a **matching mirror session** in each AZ.

3. **GWLBe attachment**

   * Confirm the endpoint is **Accepted** and **Attached** to the **CD account’s GWLB endpoint service** (see next section).

### B. In the **CD** account (appliance/GWLB owner)

1. **Endpoint Service (for GWLB)**

   * **Endpoint acceptance**: The DEV account’s GWLBe requests must show **“Accepted”** under your **Endpoint service**.
   * If you use **Allowed principals** instead of manual acceptance, ensure DEV’s account ID is present.

2. **GWLB & Target Group (type = GENEVE)**

   * **Target group type** must be **GENEVE** and **port 6081**.
   * **Registered target** = **the sensor’s capture ENI** (Interface 2).
     (Register the ENI of the NIC that is configured as *GENEVE/VXLAN target* on the appliance.)
   * **Health checks** (GWLB uses a health check tunneled over GENEVE):

     * Health check **protocol/port** must reach a service on the sensor. Use **TCP:443** (sensor UI) or **TCP:80** if the sensor responds there.
     * In the sensor’s **Security Group**, ALLOW the health-check port **from the GWLB’s subnets**.
   * **Target status** should show **healthy**. If **unhealthy**:

     * The health-check port isn’t permitted in SG/NACL, or
     * Health check port is wrong, or
     * You registered the **wrong ENI**.

3. **Security Groups / NACLs for the sensor ENI (capture)**

   * **Inbound**:

     * **UDP 6081** **from the GWLB data plane** (the subnets where your GWLB ENIs live) → **Required for GENEVE**.
     * **TCP 443 (or port used for health checks)** from the same GWLB subnets.
     * (If you ever bypass GWLB and mirror directly, also allow **UDP 4789** for VXLAN.)
   * **Outbound**: allow **ephemeral** for health-check responses.
   * **NACLs** must symmetrically allow the above.

4. **CloudWatch metrics sanity checks**

   * **GWLB Target Group**: `HealthyHostCount` = 1 (or >0). If 0 → fix health checks/SG/NACL.
   * **GWLBe**: look at `PacketsProcessed`/`BytesProcessed`. If flat → mirroring from DEV isn’t reaching the endpoint.
   * **Endpoint Service**: connection counts should rise once traffic flows.

---

# 3) Minimal change tests to localize the break

1. **Health-only test**

   * Make target group health checks pass first.
   * Once the target shows **healthy**, your GENEVE data plane is usually one SG/NACL rule away from working.

2. **Bypass GWLB (A/B test)**

   * In **DEV**, create a **Traffic Mirror Target = the sensor’s capture ENI** (cross-account mirroring is supported with proper RAM sharing, or do it in the CD account against a test source in CD).
   * Create a **mirror session** directly to that ENI with **ALLOW-ALL** filter.
   * If the ExtraHop **Interface 2** counters climb now, the sensor is fine and the issue is **GWLB pathing**.

3. **AZ pinning test**

   * Mirror a source in the **same AZ** as a known-good **GWLBe** and ensure the mirror session uses that specific endpoint. Mis-AZ wiring is a top root cause.

---

# 4) What to check when **counters are still flat** on the sensor

* **Wrong ENI registered** in the GWLB target group (very common when instances have multiple NICs).
  ✓ Register the **Interface 2 ENI** (the one shown on your ExtraHop console as the capture/GENEVE target).
* **GWLBe not accepted** in the Endpoint Service (state ≠ *Accepted*).
  ✓ Accept it or add DEV as an allowed principal.
* **Health check port mismatch** (GWLB TG uses TCP:80 but sensor only serves 443).
  ✓ Change TG health check to **TCP:443**.
* **SG/NACL misses UDP 6081** inbound to the capture ENI.
  ✓ Add explicit rules from GWLB subnets.
* **Traffic Mirror Filter too restrictive**.
  ✓ Use ALLOW-ALL during testing.
* **Mirror session points to the wrong endpoint or wrong AZ**.
  ✓ Recreate with the correct **GWLBe in the same AZ** as the source ENI.
* **Mirror packet length too small** (drops full frames).
  ✓ Set **1500**.
* **Both NICs have default routes**, causing reply traffic to leave the wrong interface.
  ✓ Gateway only on **Interface 1 (mgmt)**.

---

# 5) Exact click-path (for speed)

### DEV account

1. **EC2 → Traffic Mirroring → Mirror Sessions**

   * Open your session → verify **Source ENI**, **Target = GWLBe**, **Filter = Allow-All**, **Packet length = 1500**, **Session = Enabled**.
2. **EC2 → Traffic Mirroring → Mirror Targets**

   * Confirm target is the **correct GWLBe**.
3. **VPC → Endpoints → Gateway Load Balancer Endpoints**

   * Verify **State = Available**, **Service = your CD Endpoint Service**, **AZ** matches source ENI’s AZ.

### CD account

1. **EC2 → Load Balancers → Gateway Load Balancers**

   * Open GWLB → **Listeners** → confirm it points to the **GENEVE target group**.
2. **EC2 → Target Groups (Type = GENEVE)**

   * **Registered targets** = **sensor capture ENI**.
   * **Health checks**: set **TCP:443** (or the port your sensor serves).
   * Wait ~60s → ensure **Healthy**.
3. **VPC → Endpoint Services**

   * **Acceptance**: the DEV endpoint shows **Accepted**.
4. **EC2 → Instances → (sensor)**

   * **Security Group (capture ENI)**: add rules:

     * Inbound **UDP 6081** from **GWLB subnets**.
     * Inbound **TCP 443** from **GWLB subnets** (health checks).
   * **Security Group (mgmt ENI)**: allow your admin IPs to 443 (UI).
   * Confirm only mgmt ENI has the **default route**.

---

# 6) When traffic starts flowing

* ExtraHop **Overview** will drop the “Ready for Traffic” banner within a minute or two.
* **Health → Interfaces** shows rising RX counters on Interface 2.
* **Devices, Protocols, Dashboards** start populating.

---

## Quick remediation checklist (copy/paste)

* [ ] Mirror **Filter = Allow-All** (test only).
* [ ] Mirror **PacketLength = 1500**.
* [ ] Source ENI **AZ** = GWLBe **AZ**.
* [ ] GWLBe **Accepted** in CD Endpoint Service.
* [ ] GWLB **Target Group = GENEVE:6081**, **Target = sensor capture ENI**.
* [ ] TG **Health check = TCP:443** (or port you serve), **HealthyHostCount > 0**.
* [ ] Sensor capture ENI **SG**: **UDP 6081** + **TCP 443** from GWLB subnets.
* [ ] **Only mgmt** NIC has a **gateway**.
* [ ] If still stuck: **bypass GWLB** with direct mirror to sensor ENI → if that works, fix GWLB path.

If you paste the **Mirror Session ID**, **GWLBe ID(s)**, **TG health status**, and the **ENI IDs** you registered, I’ll pinpoint the exact mis-wire for you.
